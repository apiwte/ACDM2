<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

     <!---Bootstrap-->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
     
     <!--Socket.io-->
     <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" integrity="sha384-mZLF4UVrpi/QTWPA7BjNPEnkIfRFn4ZEO3Qt/HFklTJBj/gBOV8G3HcKn4NfQblz" crossorigin="anonymous"></script>
    
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

     
 
</head>


<body class="p-5">

    
    <% var text1 = "alert-primary" %>


  


    <div id="allDisplayText">
        <div id="displayText" class="alert <%= text1%> role="alert">
            Data is upto date. 
        </div>
    </div>

    <hr>
    <h2>VTSM A-CDM</h2>
    <p>Samui airport A-CDM portal. Trial version.</p> 
    <a class="btn btn-primary" href="#" role="button">input Database</a>
    <hr>
    <div class="container">
      <div class="row">
        <div class="col-sm">
          <label for="nameFilter"></label>
          <input class="form-control" type="text" id="nameFilter" placeholder="Search">
        </div>
        <div class="col-sm">

        </div>
        <div class="col-sm">
          <label for="dateFilter"></label>
          <input class="form-control" type="date" id="dateFilter">
        </div>
      </div>
    </div>
    <br>

    <table class="table" id="myTable">
        <thead>
          <tr class="table-info">
            <th scope="col">Airlines</th>
            <th scope="col">Flight</th>
            <th scope="col">Destination</th>
            <th scope="col">SOBT</th>
            <th scope="col">EOBT</th>
            <th scope="col">TOBT</th>
            <th scope="col">TSAT</th>
            <th scope="col">Date</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody >
          <% data.forEach(item => { %>
          <tr>
            <th scope="row"><%= item.Airlines %></th>
            <td><%= item.FlightNumber %></td>
            <td><%= item.Dest %></td>
            <td><%= item.SOBT %></td>
            <td><%= item.EOBT %></td>
            <td><%= item.TOBT %></td>
            <td><%= item.TSAT %></td>
            <td><%= item.date_ %></td>
            <td><a href="/edit/<%=item._id%>" class="btn btn-primary">Edit</a></td>
          </tr>
          <% }); %>
        </tbody>
      </table>

  

    <script src="/socket.io/socket.io.js"></script>

    <script>

        //<% var data2 = data.filter(value =>{ return value.STD == "1530"}) %>


        var socket = io()
        var html = ''
        var updatedText = 'Test'
        var box = document.querySelector('#allDisplayText')


        socket.on('acdmData', (newText) => {

            const displayText = document.getElementById('allDisplayText')

            html = 
            `
        
            <div id="displayText" class="alert alert-warning" role="alert">
                Data updated! Please refresh. 
            </div>
            
            `

            box.innerHTML = html


        })


    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var nameFilterInput = document.getElementById('nameFilter');
        var dateFilterInput = document.getElementById('dateFilter');
        var rows = document.querySelectorAll('#myTable tbody tr');

        // Set the default value of the datepicker to the current date
        var today = new Date().toISOString().split('T')[0];
        dateFilterInput.value = today;

        function applyFilters() {
          var nameFilterValue = nameFilterInput.value.toLowerCase();
          var dateFilterValue = dateFilterInput.value;

          rows.forEach(function(row) {
            var nameMatch = false;
            for (var i = 0; i < 4; i++) {
              var nameCell = row.cells[i].textContent.toLowerCase();
              if (nameCell.indexOf(nameFilterValue) > -1) {
                nameMatch = true;
                break;
              }
            }

            var dateCell = row.cells[7].textContent;
            var dateMatch = dateCell === dateFilterValue || dateFilterValue === '';

            row.style.display = nameMatch && dateMatch ? '' : 'none';
          });
        }

      

        nameFilterInput.addEventListener('input', applyFilters);
        dateFilterInput.addEventListener('input', applyFilters);
      });
    </script>


    





</body>
</html>